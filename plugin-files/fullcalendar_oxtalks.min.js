/*
 * FullCalendar v1.6.4 Oxford Talks Plugin
 * This plug-in extends the FullCalendar jQuery plugin to allow it to be easily
 * configured for use with an Oxford talks feed.
 * To configure simply add a source with an address in the format of:
 * 	talks.ox.ac.uk/show/
 * The plug-in will automatically convert the URL to retrieve the appropriate JSONP
 * and display the details on the calendar.
 * (c) 2013 David Hickman
 */
(function(a){var g=/^(http|https):\/\/talks.ox.ac.uk\/show\/.+\//;var h=/:\/\/talks.ox.ac.uk\/show\/.+\//;var f="://talks.ox.ac.uk/show/json/";var c="?callback=?";var i="https://talks.ox.ac.uk/talk/index/";function k(l){}function e(l){return l.replace(h,f)+c}function d(l){return i+l}var b=a.fullCalendar;b.sourceNormalizers.push(function(l){if(l.dataType=="oxtalks"||l.dataType===undefined&&(l.url||"").match(/^(http|https):\/\/talks.ox.ac.uk\/show\//)){l.dataType="oxtalks";if(l.editable===undefined){l.editable=false}}});b.sourceFetchers.push(function(m,n,l){if(m.dataType=="oxtalks"){return j(m,n,l)}});function j(o,p,l){function m(s){k(">> Getting Unix Timestamp for DateTime: "+s);var t;if(s){if(s instanceof Date){t=s}else{t=new Date(s)}}else{t=new Date()}k(">> Date object for Unix Timestamp: "+t);return parseInt((t.getTime())/1000)}var q=o.success;var r=e(o.url);k("Will load OxTalks data from: "+r);if(o.data&&(!(o.data.x_start_datetime===undefined)||!(o.data.x_end_datetime===undefined))){k("> Start datetime or end datetime found - modifying data object.");var n={};a.each(o.data,function(t,s){switch(t){case"x_start_datetime":n.start_time=m(s);break;case"x_end_datetime":n.end_time=m(s);break;case"start_time":if(!o.data.x_start_datetime){n[t]=s}break;case"end_time":if(!o.data.x_end_datetime){n[t]=s}break;default:n[t]=s}});k("> New data object created:");k(n);o.data=n}return a.extend({},o,{url:r,type:"GET",dataType:"jsonp",startParam:false,endParam:false,error:function(u,t,s){k("There was an error while fetching events from OxTalks: "+s.message);k(u);k(s)},success:function(s){var t=[];if(s&&s.length&&s.length>0){a.each(s,function(v,u){t.push({id:u.id,start:u.start_time,end:u.end_time,title:u.title,url:d(u.id),allDay:false})})}return t}})}})(jQuery);